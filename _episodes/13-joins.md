---
title: Joins and data in the wild
teaching: 30
exercises: 15
questions:
- "How do I join data-sets?"
objectives:
- "To be able to join tibbles"
- "To understand the difference between the different join types"
- "To have an appreciation of some of the difficulties that can occur when using real-life data"
keypoints:
- "Use join_{left,inner,right} to join data on common values"
source: Rmd
---





In this episode we will look at how to join tibbles together.  We will continue to use the gapminder data, and will look at how to join data on the medal performance of countries in the 2008 Olympics.  In doing so, we'll see some of the difficulties in working with real-world data, and will think about ways of solving them.

There are many ways of joining data in R; in common with the rest of this course we will focus on the tidyverse way, and use `dplyr` to join data.

## Loading the Olympic medal data




The [medal table for the 2008 Olympic games was downloaded from Wikipedia](https://en.wikipedia.org/wiki/2008_Summer_Olympics_medal_table) and converted to a csv file.  We can load this in the same way as the gapminder data:


~~~
medals <- read_csv("data/medals.csv")
~~~
{: .r}



~~~
Parsed with column specification:
cols(
  country = col_character(),
  gold = col_integer(),
  silver = col_integer(),
  bronze = col_integer()
)
~~~
{: .output}

We see that the column specification that `read_csv()` guessed looks reasonable; the countries are characters and columns containing the numbers of gold, silver and bronze medals have all been read as integers.

Before we join the two tables, complete the following challenges, which will generate a useful additional variable, and limit our gapminder data to the year closest to the medal data:

> ## Challenge: Generating medal totals
> 
> Use the `mutate` command to add a new column in your data-set
> called `total` that contains the total number of models awarded to 
> each country.  
>
> > ## Solution
> > 
> > 
> > ~~~
> > medals <- medals %>% mutate(total = gold + silver + bronze)
> > ~~~
> > {: .r}
> > 
> {: .solution}
{: .challenge}

> ## Challenge: Filtering the gapminder data
> 
> Use `dplyr` to create a new tibble, gap2007,  that only contains data for 2007
> 
> > ## Solution
> > 
> > 
> > ~~~
> > gap2007 <- gapminder %>% filter(year == 2007)
> > ~~~
> > {: .r}
> > 
> {: .solution}
{: .challenge}

## Joining data tables

Before we join the `medals` and `gap2007` data, let's consider a minimal
example of the different types of join that exist.


~~~
library(tibble)
animallegs <- tribble(~animal, ~legs,
                      "Cat", 4,
                      "Dog", 4,
                      "Bird", 2,
                      "Fish", 0)

animalsound <- tribble(~animal, ~sound, 
                       "Cat", "miaw",
                       "Bird", "tweet",
                       "Fish", NA,
                       "Cow", "moo")
~~~
{: .r}




~~~
# Need to think here about how we handle missings _in data_
# vs missings generated by the join
animallegs %>% inner_join(animalsound)
~~~
{: .r}



~~~
Joining, by = "animal"
~~~
{: .output}



~~~
# A tibble: 3 x 3
  animal  legs sound
   <chr> <dbl> <chr>
1    Cat     4  miaw
2   Bird     2 tweet
3   Fish     0  <NA>
~~~
{: .output}



~~~
animallegs %>% left_join(animalsound)
~~~
{: .r}



~~~
Joining, by = "animal"
~~~
{: .output}



~~~
# A tibble: 4 x 3
  animal  legs sound
   <chr> <dbl> <chr>
1    Cat     4  miaw
2    Dog     4  <NA>
3   Bird     2 tweet
4   Fish     0  <NA>
~~~
{: .output}



~~~
animallegs %>% right_join(animalsound)
~~~
{: .r}



~~~
Joining, by = "animal"
~~~
{: .output}



~~~
# A tibble: 4 x 3
  animal  legs sound
   <chr> <dbl> <chr>
1    Cat     4  miaw
2   Bird     2 tweet
3   Fish     0  <NA>
4    Cow    NA   moo
~~~
{: .output}



~~~
medaljoin <- gapminder %>% 
  filter(year == 2007) %>% 
  inner_join(medals, by="country") # Illustrate difference between join types
~~~
{: .r}

~~~
medaljoin %>% ggplot(aes(x=gdpPercap, y=medalTotal, colour = continent)) + 
  geom_point()
~~~
{: .r}



~~~
Error in FUN(X[[i]], ...): object 'medalTotal' not found
~~~
{: .error}

<img src="../fig/rmd-13-unnamed-chunk-9-1.png" title="plot of chunk unnamed-chunk-9" alt="plot of chunk unnamed-chunk-9" style="display: block; margin: auto;" />

